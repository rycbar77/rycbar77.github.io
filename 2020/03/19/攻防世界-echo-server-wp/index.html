<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#blog'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>攻防世界_echo-server_wp - My Tiny Ideas</title>
  
    <meta name="keywords" content="ctf,re,花指令">
  
  
    <meta name="description" content="这题涉及到去花和patch，难度不是很大">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  
  <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/favicon/favicon.ico">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
    
      
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-light.css">

    
  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128484503-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-128484503-1');
    </script>
  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h'>
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
          
            RYCBAR'S <b><sup style='color:#3AA757'>blog</sup></b>
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box reveal shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h1 class="title">
    <a href="/2020/03/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-echo-server-wp/">
      攻防世界_echo-server_wp
    </a>
  </h1>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="http://blog.rycbar.club" rel="nofollow">
    <img src="https://q2.qlogo.cn/headimg_dl?dst_uin=595371936&spec=100">
    <p>rycbar</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/ctf/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>ctf</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2020年3月19日</p>
  </a>
</div>

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <p>这题涉及到去花和patch，难度不是很大</p>
<a id="more"></a>

<p>先file查看一下文件，32位ELF，运行一下</p>
<pre><code>               **************
               Echo Server 0.3 ALPHA
               **************</code></pre><p>等待输入，随便输入一句</p>
<pre><code>hhh
686868</code></pre><p>直接返回了ASCII码值</p>
<p>用IDA打开看看</p>
<pre><code class="c++">int __cdecl main()
{
  setbuf(stdin, 0);
  setbuf(stdout, 0);
  dword_804A088 = 1;
  puts(&quot;               **************\n               Echo Server 0.3 ALPHA\n               **************&quot;);
  ((void (*)(void))((char *)&amp;loc_80487C1 + 3))();
  return 0;
}</code></pre>
<p><code>main</code>函数没什么特别的，就是最后这个函数调用很古怪，所以进去看看</p>
<pre><code class="c++">void __cdecl sub_804875D(unsigned __int8 *a1, unsigned int a2)
{
  unsigned __int8 *v2; // eax
  char v3; // zf
  unsigned __int8 *v4; // [esp+18h] [ebp-10h]
  unsigned int i; // [esp+1Ch] [ebp-Ch]

  v4 = a1;
  if ( a1 )
  {
    for ( i = 0; i &lt; a2; ++i )
    {
      v2 = v4++;
      printf(&quot;%02X&quot;, *v2);
    }
  }
  else
  {
    printf(&quot;NULL&quot;);
  }
  putchar(10);
  JUMPOUT(v3, (char *)&amp;loc_80487C1 + 1);
  JUMPOUT(!v3, (char *)&amp;loc_80487C1 + 1);
  MEMORY[0x915A4B8F]();
  JUMPOUT(loc_80487C6);
}</code></pre>
<p>出现了访问内存越界的情况<code>MEMORY[0x915A4B8F]()</code>，看到上面两句更加古怪</p>
<pre><code class="c++">JUMPOUT(v3, (char *)&amp;loc_80487C1 + 1);
JUMPOUT(!v3, (char *)&amp;loc_80487C1 + 1);</code></pre>
<p>这里很明显是强行创造多条分支，IDA使用递归行进算法，就会默认这条路径接这两个函数执行过后的指令是有效的而去扫描分析后面的指令，但实际上，后面是永远不会到达的指令，不管v3的值是多少，都会跳转到<code>(char *)&amp;loc_80487C1 + 1</code>这显然是一条花指令，所以查看一下汇编代码准备去花</p>
<pre><code class="asm">.text:0804875D ; Attributes: bp-based frame
.text:0804875D
.text:0804875D sub_804875D     proc near
.text:0804875D
.text:0804875D var_10          = dword ptr -10h
.text:0804875D var_C           = dword ptr -0Ch
.text:0804875D arg_0           = dword ptr  8
.text:0804875D arg_4           = dword ptr  0Ch
.text:0804875D
.text:0804875D ; __unwind {
.text:0804875D                 push    ebp
.text:0804875E                 mov     ebp, esp
.text:08048760                 sub     esp, 28h
.text:08048763                 mov     eax, [ebp+arg_0]
.text:08048766                 mov     [ebp+var_10], eax
.text:08048769                 cmp     [ebp+arg_0], 0
.text:0804876D                 jnz     short loc_804877D
.text:0804876F                 mov     dword ptr [esp], offset format ; &quot;NULL&quot;
.text:08048776                 call    _printf
.text:0804877B                 jmp     short loc_80487B1
.text:0804877D ; ---------------------------------------------------------------------------
.text:0804877D
.text:0804877D loc_804877D:                            ; CODE XREF: sub_804875D+10↑j
.text:0804877D                 mov     [ebp+var_C], 0
.text:08048784                 jmp     short loc_80487A9
.text:08048786 ; ---------------------------------------------------------------------------
.text:08048786
.text:08048786 loc_8048786:                            ; CODE XREF: sub_804875D+52↓j
.text:08048786                 mov     eax, [ebp+var_10]
.text:08048789                 lea     edx, [eax+1]
.text:0804878C                 mov     [ebp+var_10], edx
.text:0804878F                 movzx   eax, byte ptr [eax]
.text:08048792                 movzx   eax, al
.text:08048795                 mov     [esp+4], eax
.text:08048799                 mov     dword ptr [esp], offset a02x ; &quot;%02X&quot;
.text:080487A0                 call    _printf
.text:080487A5                 add     [ebp+var_C], 1
.text:080487A9
.text:080487A9 loc_80487A9:                            ; CODE XREF: sub_804875D+27↑j
.text:080487A9                 mov     eax, [ebp+var_C]
.text:080487AC                 cmp     eax, [ebp+arg_4]
.text:080487AF                 jb      short loc_8048786
.text:080487B1
.text:080487B1 loc_80487B1:                            ; CODE XREF: sub_804875D+1E↑j
.text:080487B1                 mov     dword ptr [esp], 0Ah ; c
.text:080487B8                 call    _putchar
.text:080487BD                 jz      short near ptr loc_80487C1+1
.text:080487BF                 jnz     short near ptr loc_80487C1+1
.text:080487C1
.text:080487C1 loc_80487C1:                            ; CODE XREF: sub_804875D+60↑j
.text:080487C1                                         ; sub_804875D+62↑j ...
.text:080487C1                 call    near ptr 915A4B8Fh
.text:080487C1 sub_804875D     endp ; sp-analysis failed
.text:080487C1
.text:080487C6
.text:080487C6 loc_80487C6:                            ; DMA page register 74LS612:
.text:080487C6                 in      eax, 81h        ; Channel 2 (diskette DMA)  (address bits 16-23)
.text:080487C8                 in      al, dx
.text:080487C9                 mov     [eax], al
.text:080487C9 ; ---------------------------------------------------------------------------</code></pre>
<p>这个函数显然是不对的，堆栈本身并没有平衡，<code>main</code>函数里跳到的地方是<code>0x080487C4</code>已经被其它指令占了，这里去花一下，多余的指令码干脆用<code>nop</code>patch掉</p>
<pre><code class="asm">sub_804875D     proc near
.text:0804875D
.text:0804875D var_10          = dword ptr -10h
.text:0804875D var_C           = dword ptr -0Ch
.text:0804875D arg_0           = dword ptr  8
.text:0804875D arg_4           = dword ptr  0Ch
.text:0804875D
.text:0804875D ; __unwind {
.text:0804875D                 push    ebp
.text:0804875E                 mov     ebp, esp
.text:08048760                 sub     esp, 28h
.text:08048763                 mov     eax, [ebp+arg_0]
.text:08048766                 mov     [ebp+var_10], eax
.text:08048769                 cmp     [ebp+arg_0], 0
.text:0804876D                 jnz     short loc_804877D
.text:0804876F                 mov     dword ptr [esp], offset format ; &quot;NULL&quot;
.text:08048776                 call    _printf
.text:0804877B                 jmp     short loc_80487B1
.text:0804877D ; ---------------------------------------------------------------------------
.text:0804877D
.text:0804877D loc_804877D:                            ; CODE XREF: sub_804875D+10↑j
.text:0804877D                 mov     [ebp+var_C], 0
.text:08048784                 jmp     short loc_80487A9
.text:08048786 ; ---------------------------------------------------------------------------
.text:08048786
.text:08048786 loc_8048786:                            ; CODE XREF: sub_804875D+52↓j
.text:08048786                 mov     eax, [ebp+var_10]
.text:08048789                 lea     edx, [eax+1]
.text:0804878C                 mov     [ebp+var_10], edx
.text:0804878F                 movzx   eax, byte ptr [eax]
.text:08048792                 movzx   eax, al
.text:08048795                 mov     [esp+4], eax
.text:08048799                 mov     dword ptr [esp], offset a02x ; &quot;%02X&quot;
.text:080487A0                 call    _printf
.text:080487A5                 add     [ebp+var_C], 1
.text:080487A9
.text:080487A9 loc_80487A9:                            ; CODE XREF: sub_804875D+27↑j
.text:080487A9                 mov     eax, [ebp+var_C]
.text:080487AC                 cmp     eax, [ebp+arg_4]
.text:080487AF                 jb      short loc_8048786
.text:080487B1
.text:080487B1 loc_80487B1:                            ; CODE XREF: sub_804875D+1E↑j
.text:080487B1                 mov     dword ptr [esp], 0Ah ; c
.text:080487B8                 call    _putchar
.text:080487BD                 jz      short locret_80487C2
.text:080487BF                 jnz     short locret_80487C2
.text:080487C1                 nop                     ; Keypatch modified this from:
.text:080487C1                                         ;   db 0E8h
.text:080487C2
.text:080487C2 locret_80487C2:                         ; CODE XREF: sub_804875D+60↑j
.text:080487C2                                         ; sub_804875D+62↑j
.text:080487C2                 leave
.text:080487C3                 retn
.text:080487C3 ; } // starts at 804875D
.text:080487C3 sub_804875D     endp</code></pre>
<p>这是这个函数本来的样子，而<code>main</code>函数里面调用的根本就不是这个函数，而是下面</p>
<pre><code class="asm">.text:080487C4 ; ---------------------------------------------------------------------------
.text:080487C4 ; __unwind {
.text:080487C4                 push    ebp             ; CODE XREF: main+49↓p
.text:080487C5                 mov     ebp, esp
.text:080487C7                 sub     esp, 88h
.text:080487CD                 mov     eax, large gs:14h
.text:080487D3                 mov     [ebp-0Ch], eax
.text:080487D6                 xor     eax, eax
.text:080487D8                 mov     dword ptr [esp+8], 14h
.text:080487E0                 mov     dword ptr [esp+4], 0
.text:080487E8                 lea     eax, [ebp-70h]
.text:080487EB                 mov     [esp], eax
.text:080487EE                 call    _memset
.text:080487F3
.text:080487F3 loc_80487F3:                            ; CODE XREF: .text:loc_80487F3↑j
.text:080487F3                 jmp     short near ptr loc_80487F3+1
.text:080487F3 ; ---------------------------------------------------------------------------
.text:080487F5                 db 0C0h
.text:080487F6                 db  48h ; H
.text:080487F7                 db 0C7h</code></pre>
<p>下面并没有分析，因为又遇到了一个花指令</p>
<pre><code class="asm">.text:080487F3                 jmp     short near ptr loc_80487F3+1</code></pre>
<p>代码重叠，分析一下本来的指令是什么</p>
<pre><code class="asm">text:080487F4 ; ---------------------------------------------------------------------------
.text:080487F4                 inc     eax
.text:080487F6                 dec     eax
.text:080487F7                 mov     dword ptr [esp+8], 14h
.text:080487FF                 lea     eax, [ebp-70h]
.text:08048802                 mov     [esp+4], eax
.text:08048806                 mov     dword ptr [esp], 0
.text:0804880D                 call    _read
.text:08048812                 xor     eax, eax
.text:08048814                 jz      short loc_804881D
.text:08048816                 jmp     near ptr 6F44B961h</code></pre>
<p>又来</p>
<pre><code class="asm">.text:08048812                 xor     eax, eax
.text:08048814                 jz      short loc_804881D</code></pre>
<p>自己和自己异或肯定是0，这个跳转是一定会实现的，后面的语句并没有什么用但是IDA还是进行了分析然后出错，patch掉继续看</p>
<pre><code class="asm">.text:08048816                 nop                     ; Keypatch modified this from:
.text:08048816                                         ;   db 0E9h
.text:08048816 ; ---------------------------------------------------------------------------
.text:08048817 aF1Ga           db &#39;F1@gA&#39;,0
.text:0804881D ; ---------------------------------------------------------------------------
.text:0804881D
.text:0804881D loc_804881D:                            ; CODE XREF: .text:08048814↑j
.text:0804881D                 mov     dword ptr [esp+8], 5
.text:08048825                 mov     dword ptr [esp+4], 8048817h
.text:0804882D                 lea     eax, [ebp-70h]
.text:08048830                 mov     [esp], eax
.text:08048833                 call    _strncmp
.text:08048838                 test    eax, eax
.text:0804883A                 jnz     short loc_80488A3
.text:0804883C                 mov     dword ptr [esp], offset aYouAreVeryClos ; &quot;You are very close! Now patch me~&quot;
.text:08048843                 call    _puts
.text:08048848                 mov     eax, ds:dword_804A088
.text:0804884D                 test    eax, eax
.text:0804884F                 jz      short loc_8048866</code></pre>
<p>去花之后变成了一个字符串，后面还有一个比较操作，如果输入这个字符串，就会输出<code>You are very close! Now patch me~</code></p>
<p>后面肯定还有操作，往后面看</p>
<pre><code class="asm">.text:08048848                 mov     eax, ds:dword_804A088
.text:0804884D                 test    eax, eax
.text:0804884F                 jz      short loc_8048866</code></pre>
<p>这三句很关键，如果<code>eax</code>是0，就会进行后面的跳转，所以查找一下<code>ds:dword_804A088</code>交叉引用，在<code>main</code>里面发现</p>
<pre><code class="asm">.text:08048913                 mov     ds:dword_804A088, 1</code></pre>
<p>所以这个跳转是永远不会实现的，先看看不跳转后面会执行什么</p>
<pre><code class="asm">.text:08048851 loc_8048851:                            ; CODE XREF: .text:08048857↓j
.text:08048851                 mov     ax, 5EBh
.text:08048855                 xor     eax, eax
.text:08048857                 jz      short near ptr loc_8048851+1</code></pre>
<p>又是一个花指令，重新分析这几句</p>
<pre><code class="asm">.text:08048852 loc_8048852:                            ; CODE XREF: .text:08048857↓j
.text:08048852                 mov     eax, 0C03105EBh
.text:08048857                 jz      short loc_8048852</code></pre>
<p>发现进入了一个死循环，所以题目让我们patch的意思是不走这个循环，也就是真正应该执行的是前面没走的那个分支</p>
<pre><code class="asm">loc_8048866:                            ; CODE XREF: .text:0804884F↑j
.text:08048866                 lea     eax, [ebp-70h]
.text:08048869                 mov     [esp], eax
.text:0804886C                 call    _strlen
.text:08048871                 mov     dword ptr [esp+8], 0
.text:08048879                 mov     [esp+4], eax
.text:0804887D                 lea     eax, [ebp-70h]
.text:08048880                 add     eax, 1
.text:08048883                 mov     [esp], eax
.text:08048886                 call    _MD5
.text:0804888B                 mov     [ebp-74h], eax
.text:0804888E                 mov     dword ptr [esp+4], 10h
.text:08048896                 mov     eax, [ebp-74h]
.text:08048899                 mov     [esp], eax
.text:0804889C                 call    sub_804875D
.text:080488A1                 jmp     short loc_80488C0
.text:080488A3 ; ---------------------------------------------------------------------------
.text:080488A3
.text:080488A3 loc_80488A3:                            ; CODE XREF: .text:0804883A↑j
.text:080488A3                 lea     eax, [ebp-70h]
.text:080488A6                 mov     [esp], eax
.text:080488A9                 call    _strlen
.text:080488AE                 sub     eax, 1
.text:080488B1                 mov     [esp+4], eax
.text:080488B5                 lea     eax, [ebp-70h]
.text:080488B8                 mov     [esp], eax
.text:080488BB                 call    sub_804875D
.text:080488C0
.text:080488C0 loc_80488C0:                            ; CODE XREF: .text:080488A1↑j
.text:080488C0                 mov     eax, ds:stdout
.text:080488C5                 mov     [esp], eax
.text:080488C8                 call    _fflush
.text:080488CD                 mov     eax, [ebp-0Ch]
.text:080488D0                 xor     eax, large gs:14h
.text:080488D7                 jz      short locret_80488DE
.text:080488D9                 call    ___stack_chk_fail
.text:080488DE ; ---------------------------------------------------------------------------
.text:080488DE
.text:080488DE locret_80488DE:                         ; CODE XREF: .text:080488D7↑j
.text:080488DE                 leave
.text:080488DF                 retn
.text:080488DF ; } // starts at 80487C4</code></pre>
<p>执行到结束，计算了一个<code>md5</code>然后调用最开始分析的<code>sub_804875D</code>函数以16进制的形式输出，所以这里有两个选择，有linux环境可以直接patch跳转语句然后执行得到flag</p>
<pre><code class="bash">-&gt;./echo-server 
               **************
               Echo Server 0.3 ALPHA
               **************
F1@gA
You are very close! Now patch me~
F8C60EB40BF66919A77C4BD88D45DEF4</code></pre>
<p>当然也可以自己算<code>md5</code>，看看关键函数</p>
<pre><code class="asm">.text:08048866                 lea     eax, [ebp-70h]
.text:08048869                 mov     [esp], eax
.text:0804886C                 call    _strlen
.text:08048871                 mov     dword ptr [esp+8], 0
.text:08048879                 mov     [esp+4], eax
.text:0804887D                 lea     eax, [ebp-70h]
.text:08048880                 add     eax, 1
.text:08048883                 mov     [esp], eax
.text:08048886                 call    _MD5</code></pre>
<p>首先是把我们输入的字符串的地址拷贝到<code>eax</code>中，把该地址写到栈顶，调用<code>_strlen</code>，求的就是我们输入的字符串的长度，我们输入的是<code>&#39;F1@gA\n&#39;</code>，返回的值是<code>0x06</code>，储存在eax中，写到了栈顶的第二个位置（第三个位置的0并不知道什么意思，或许是第三个参数，没查到函数原型，暂时先不管了），但是栈顶元素并不是我们输入的字符串，而是首地址加1的位置，长度还是6，所以要用<code>md5</code>加密的字符串应该是<code>&#39;1@gA\x0a\x00&#39;</code>，<code>python</code>调用<code>hashlib</code>算一下</p>
<pre><code class="python">import hashlib
m=hashlib.md5()
m.update(b&#39;1@gA\x0a\x00&#39;)
m.hexdigest().upper()
#&#39;F8C60EB40BF66919A77C4BD88D45DEF4&#39;</code></pre>
<p>两种方法都可以得到flag</p>
<pre><code>F8C60EB40BF66919A77C4BD88D45DEF4</code></pre><p>其实这题并没有什么难度，为什么写这么长呢？</p>
<p><del>(实在不想写数据结构作业)</del></p>

          
            <div class='article_footer'>
              
                
  
    
    



  

  
    
    



  

  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=http://blog.rycbar.club/2020/03/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-echo-server-wp/>http://blog.rycbar.club/2020/03/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-echo-server-wp/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  


              
            </div>
          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-03-24T10:50:29+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2020年3月24日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/ctf/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>ctf</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/re/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>re</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E8%8A%B1%E6%8C%87%E4%BB%A4/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>花指令</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.rycbar.club/2020/03/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-echo-server-wp/&title=攻防世界_echo-server_wp - My Tiny Ideas&summary=这题涉及到去花和patch，难度不是很大"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.rycbar.club/2020/03/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-echo-server-wp/&title=攻防世界_echo-server_wp - My Tiny Ideas&summary=这题涉及到去花和patch，难度不是很大"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=http://blog.rycbar.club/2020/03/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-echo-server-wp/&title=攻防世界_echo-server_wp - My Tiny Ideas&summary=这题涉及到去花和patch，难度不是很大"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2020/03/21/BJDCTF-re-wp/'>
                <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>BJDCTF-re-wp</p>
                <p class='content'>这么长时间就出了两道这么简单的re出题人的良心不会痛吗
re选手做完两道题结束比赛……
本来还想做做pwn，有时间再说吧


guessgame随机数用时间种子初始化过了，猜是猜不对的，而且猜对...</p>
              </a>
            
            
              <a class='next' href='/2020/03/16/handcrafted-pyc-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/'>
                <p class='title'>handcrafted-pyc-攻防世界<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>很早以前就想写一篇关于python的字节码的文章，但是一直没什么时间，借着刚好做到这一题，写一写我对相关内容的理解。


准备工作拿到的题目并不是一个pyc格式的文件
#!/usr/bin/en...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box reveal comments shadow">
    <section class="article typo">
      <p ct><i class='fas fa-comments'></i> 评论</p>
      
      
      
      
        <section id="comments">
          <div id="gitalk-container"></div>
        </section>
      
      
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '攻防世界_echo-server_wp',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    



  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.7'
      loop='all'
      order='random'
      fixed='false'
      list-max-height='340px'
      server='netease'
      type='playlist'
      id='555017395'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/rycbar17th@gmail.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/schrodinger17"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=391265665"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        <div class='copyright'>
        <p><a href="https://blog.rycbar.club">Copyright © 2017-2020 rycbar</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '8px',
        duration: '800',
        interval: '100',
        scale: '1'
      });
    });
  </script>


  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/BBC19066-E176-47C2-9D22-48C81EE5DF6B.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/B18FCBB3-67FD-48CC-B4F3-457BA145F17A.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/35F12181-F0E9-45BD-B134-37E4B4A660CF.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/00E0F0ED-9F1C-407A-9AA6-545649D919F4.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/67239FBB-E15D-4F4F-8EE8-0F1C9F3C4E7C.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/B951AE18-D431-417F-B3FE-A382403FF21B.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/AEB33F9D-7294-4CF1-B8C5-3020748A9D45.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/2884F904-F1F3-479E-AE27-5EBC291B63B0.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/10A0FCE5-36A1-4AD0-8CF0-019259A89E03.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/250662D4-5A21-4AAA-BB63-CD25CF97CFF1.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/298468D7-E388-44A8-8CC5-8213BDC33CED.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  






  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: "6dbe0fb891585031b176",
      clientSecret: "4407fec5af8e37150b5a4cb82821318d91c07769",
      repo: "comments",
      owner: "schrodinger17",
      admin: "schrodinger17",
      
        id: location.pathname,      // Ensure uniqueness and length less than 50
      
      distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
  </script>








  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.6.5/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>




  
    
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
  



<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
</body>
</html>
