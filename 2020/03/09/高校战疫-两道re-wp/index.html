<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#blog'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>高校战疫-两道re-wp - My Tiny Ideas</title>
  
    <meta name="keywords" content="ctf,writeup,re,高校战“疫”">
  
  
    <meta name="description" content="这两天攻防世界有个比赛，上面的题目还不错，参与了一下，至于为什么是两道re，因为正好赶上数模美赛，没怎么有时间做（实际上就是因为菜">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  
  <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/favicon/favicon.ico">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
    
      
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-light.css">

    
  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128484503-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-128484503-1');
    </script>
  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h'>
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
          
            RYCBAR'S <b><sup style='color:#3AA757'>blog</sup></b>
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box reveal shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h1 class="title">
    <a href="/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB-%E4%B8%A4%E9%81%93re-wp/">
      高校战疫-两道re-wp
    </a>
  </h1>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="http://blog.rycbar.club" rel="nofollow">
    <img src="https://q2.qlogo.cn/headimg_dl?dst_uin=595371936&spec=100">
    <p>rycbar</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/ctf/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>ctf</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2020年3月9日</p>
  </a>
</div>

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <p>这两天攻防世界有个比赛，上面的题目还不错，参与了一下，至于为什么是两道re，因为正好赶上数模美赛，没怎么有时间做（实际上就是因为菜</p>
<a id="more"></a>

<h4 id="cyclegraph"><a href="#cyclegraph" class="headerlink" title="cyclegraph"></a>cyclegraph</h4><pre><code class="c++">void FUN_00401080(void)

{
  char cVar1;
  char *pcVar2;
  undefined4 *puVar3;
  undefined1 unaff_DI;
  int iVar4;
  char local_20 [4];
  char local_1c;
  char acStack27 [16];
  char local_b;
  uint local_8;

  local_8 = DAT_00403004 ^ (uint)&amp;stack0xfffffffc;
  DAT_00403370 = 0;
  puVar3 = &amp;DAT_00403384;
  DAT_00403374 = &#39;0&#39;;
  DAT_00403378 = &amp;DAT_00403380;
  iVar4 = 0;
  do {
    puVar3[-1] = *(undefined4 *)((int)null_ARRAY_00402178 + iVar4);
    *(undefined4 **)puVar3 = &amp;DAT_00403380 + *(int *)((int)null_ARRAY_00402278 + iVar4) * 3;
    *(undefined4 **)(puVar3 + 1) = &amp;DAT_00403380 + *(int *)((int)null_ARRAY_004021f8 + iVar4) * 3;
    puVar3 = puVar3 + 3;
    iVar4 = iVar4 + 4;
  } while ((int)puVar3 &lt; 0x403504);
  print(&quot;You need a flag to get out of this:\n&quot;,unaff_DI);
  scan(&amp;DAT_0040214c,0xe0);
  iVar4 = 5;
  do {
    cVar1 = local_20[iVar4];
    if (*DAT_00403378 + (int)DAT_00403374 == (int)cVar1) {
      DAT_00403378 = (int *)DAT_00403378[1];
    }
    else {
      if ((int)DAT_00403374 - *DAT_00403378 != (int)cVar1) {
        print(&quot;This is not flag~\n&quot;,unaff_DI);
        system(&quot;pause&quot;);
                    /* WARNING: Subroutine does not return */
        exit(1);
      }
      DAT_00403378 = (int *)DAT_00403378[2];
    }
    DAT_00403374 = local_20[iVar4];
    DAT_00403370 = DAT_00403370 + 1;
    iVar4 = iVar4 + 1;
  } while (iVar4 &lt; 0x15);
  if (((((local_20[0] == &#39;f&#39;) &amp;&amp; (local_20[1] == &#39;l&#39;)) &amp;&amp; (local_20[2] == &#39;a&#39;)) &amp;&amp;
      ((local_20[3] == &#39;g&#39; &amp;&amp; (local_1c == &#39;{&#39;)))) &amp;&amp; (local_b == &#39;}&#39;)) {
    if ((DAT_00403370 &lt; 0x11) &amp;&amp; (DAT_00403378 == (int *)&amp;DAT_004034f4)) {
      pcVar2 = &quot;Congratulations!!\n&quot;;
    }
    else {
      pcVar2 = &quot;This is not flag~\n&quot;;
    }
  }
  else {
    pcVar2 = &quot;illegal input~\n&quot;;
  }
  print(pcVar2,cVar1);
  system(&quot;pause&quot;);
  FUN_004011f4();
  return;
}</code></pre>
<p>表面上看起来很复杂，仔细研究就会发现，开始的循环是在构造一个有向图，用到了一个结构体，而后面的部分是一个寻路的过程，正向的过程是根据输入的flag的值进行移动，最终走到最后一个位置，所以逆向的过程就是先寻找路径，然后通过找到的路径来计算flag的值</p>
<pre><code class="c++">#include &lt;iostream&gt;

using namespace std;
struct a {
    int val;
    a *loc1;
    a *loc2;
};

bool dfs(a *ss, a *ee, int n, a *s[]) {
    if (n == 0) {
        return ss == ee;
    }
    if (dfs(ss-&gt;loc1, ee, n - 1, s)) {
        for (int i = 0; i &lt; 0x11; i++) {
            if (s[i] == nullptr) {
                s[i] = ss-&gt;loc1;
                break;
            }
        }
        return true;
    } else {
        if (dfs(ss-&gt;loc2, ee, n - 1, s)) {
            for (int i = 0; i &lt; 0x11; i++) {
                if (s[i] == nullptr) {
                    s[i] = ss-&gt;loc2;
                    break;
                }
            }
            return true;
        }
    }
}

void fun() {
    int dword_402178[] =
            {
                    52, 2, 44, 42, 6, 42, 47, 42, 51, 3, 2, 50, 50, 50, 48, 3, 1, 50, 43, 2, 46, 1, 2, 45, 50, 4, 45,
                    48, 49, 47, 51, 5
            };
    int dword_4021F8[] =
            {
                    1, 8, 7, 23, 9, 19, 31, 23, 9, 13, 12, 29, 10, 24, 9, 24, 25, 9, 26, 3, 22, 6, 17, 13, 7, 15, 20, 1,
                    16, 4, 11, 31
            };
    int dword_402278[] =
            {
                    2, 2, 1, 18, 7, 2, 26, 13, 4, 10, 4, 21, 14, 1, 0, 14, 5, 7, 28, 12, 28, 15, 15, 2, 16, 23, 30, 23,
                    19, 9, 22, 31
            };

    a puVar3[32];
    a *DAT_00403378 = puVar3;
    a *s[0x12]= {nullptr};
    int i = 0;
    do {
        puVar3[i].val = dword_402178[i];
        puVar3[i].loc1 = &amp;puVar3[dword_402278[i]];
        puVar3[i].loc2 = &amp;puVar3[dword_4021F8[i]];
        i++;
    } while (i &lt; 32);

    dfs(DAT_00403378, &amp;puVar3[31], 0x10, s);
    DAT_00403378 = puVar3;
    string flag;
    int DAT_00403374 = 48;
    char tmp;
    for(int j=0; j &lt; 0x10; j++)
    {
        if(s[0xf-j]==DAT_00403378-&gt;loc1)
        {
            tmp=DAT_00403378-&gt;val + DAT_00403374;
            DAT_00403378=DAT_00403378-&gt;loc1;

        } else{
            tmp=DAT_00403374 - DAT_00403378-&gt;val;
            DAT_00403378=DAT_00403378-&gt;loc2;
        }
        flag+=tmp;
        DAT_00403374 = tmp;
    }
    cout&lt;&lt;flag&lt;&lt;endl;
//    int input[0x15];
//    int iVar4 = 5;
//    int DAT_00403374 = 48;
//    do {
//        int cVar1 = input[iVar4];
//        if (DAT_00403378-&gt;val + DAT_00403374 == cVar1) {
//            DAT_00403378 = DAT_00403378-&gt;loc1;
//        } else {
//            if (DAT_00403374 - DAT_00403378-&gt;val == cVar1) {
//                DAT_00403378 = DAT_00403378-&gt;loc2;
//            }
//        }
//        DAT_00403374 = input[iVar4];
//        iVar4 = iVar4 + 1;
//    } while (iVar4 &lt; 0x15);


//    if (((((input[0] == &#39;f&#39;) &amp;&amp; (input[1] == &#39;l&#39;)) &amp;&amp; (input[2] == &#39;a&#39;)) &amp;&amp;
//         ((input[3] == &#39;g&#39; &amp;&amp; (input[4] == &#39;{&#39;)))) &amp;&amp; (input[0x14] == &#39;}&#39;)) {
//        if (DAT_00403378 == &amp;puVar3[31]) {
//            string s = &quot;Congratulations!!\n&quot;;
//        }
//    }

}

int main()
{
    fun();
    return 0;
}</code></pre>
<p>注释部分是对于程序的一个正向还原，寻路用到了<code>dfs</code>算法，不是很难。</p>
<p>最后得到flag</p>
<pre><code>flag{d8b0bc97a6c0ba27}</code></pre><h4 id="天津垓"><a href="#天津垓" class="headerlink" title="天津垓"></a>天津垓</h4><p>题目里所有的内容都是假面骑士……</p>
<p>首先可以关注到一个函数名为<code>f</code> 的函数，这个函数很简单</p>
<pre><code class="c++">__int64 __fastcall f(__int64 a1, char **a2, char **a3)
{
  _main(a1, (__int64)a2, (__int64)a3);
  printf(&quot;Authorize:&quot;);
  sub_1004011F6();
  sub_100401AA0();
  return 0i64;
}

int sub_1004011F6()
{
  char v1; // [rsp+20h] [rbp-D0h]
  char v2; // [rsp+21h] [rbp-CFh]
  char v3; // [rsp+22h] [rbp-CEh]
  char v4; // [rsp+23h] [rbp-CDh]
  char v5; // [rsp+24h] [rbp-CCh]
  char v6; // [rsp+25h] [rbp-CBh]
  char v7; // [rsp+26h] [rbp-CAh]
  char v8; // [rsp+27h] [rbp-C9h]
  char v9; // [rsp+28h] [rbp-C8h]
  char v10; // [rsp+29h] [rbp-C7h]
  char v11; // [rsp+2Ah] [rbp-C6h]
  char v12; // [rsp+2Bh] [rbp-C5h]
  char v13; // [rsp+2Ch] [rbp-C4h]
  char v14; // [rsp+2Dh] [rbp-C3h]
  char v15; // [rsp+2Eh] [rbp-C2h]
  char v16; // [rsp+2Fh] [rbp-C1h]
  char v17; // [rsp+30h] [rbp-C0h]
  char v18; // [rsp+31h] [rbp-BFh]
  char Format[4]; // [rsp+38h] [rbp-B8h]
  char v20[2]; // [rsp+3Dh] [rbp-B3h]
  __int64 v21; // [rsp+40h] [rbp-B0h]
  __int64 v22; // [rsp+48h] [rbp-A8h]
  __int16 v23; // [rsp+50h] [rbp-A0h]
  char v24; // [rsp+52h] [rbp-9Eh]
  __int64 v25; // [rsp+60h] [rbp-90h]
  __int64 v26; // [rsp+68h] [rbp-88h]
  __int64 v27; // [rsp+70h] [rbp-80h]
  __int64 v28; // [rsp+78h] [rbp-78h]
  __int64 v29; // [rsp+80h] [rbp-70h]
  __int16 v30; // [rsp+88h] [rbp-68h]
  __int64 v31; // [rsp+90h] [rbp-60h]
  __int64 v32; // [rsp+98h] [rbp-58h]
  __int64 v33; // [rsp+A0h] [rbp-50h]
  __int64 v34; // [rsp+A8h] [rbp-48h]
  __int64 v35; // [rsp+B0h] [rbp-40h]
  __int64 v36; // [rsp+B8h] [rbp-38h]
  __int64 v37; // [rsp+C0h] [rbp-30h]
  __int64 v38; // [rsp+C8h] [rbp-28h]
  __int64 v39; // [rsp+DCh] [rbp-14h]
  int v40; // [rsp+E4h] [rbp-Ch]
  __int16 v41; // [rsp+E8h] [rbp-8h]
  char v42; // [rsp+EAh] [rbp-6h]
  char v43; // [rsp+EBh] [rbp-5h]
  int i; // [rsp+ECh] [rbp-4h]

  v39 = &#39;H_gnisiR&#39;;
  v40 = &#39;eppo&#39;;
  v41 = &#39;!r&#39;;
  v42 = 0;
  v31 = &#39;eht nehW&#39;;
  v32 = &#39;oh evif &#39;;
  v33 = &#39;sorc snr&#39;;
  v34 = &#39;g eht ,s&#39;;
  v35 = &#39;os nedlo&#39;;
  v36 = &#39;HT reidl&#39;;
  v37 = &#39;si RESUO&#39;;
  v38 = &#39;\n.nrob &#39;;
  v25 = &#39;t pmuj A&#39;;
  v26 = &#39;ks eht o&#39;;
  v27 = &#39; snrut y&#39;;
  v28 = &#39;dir a ot&#39;;
  v29 = &#39;.kcik re&#39;;
  v30 = &#39;\n&#39;;
  v21 = &#39;etneserP&#39;;
  v22 = &#39;IAZ yb d&#39;;
  v23 = &#39;\nA&#39;;
  v24 = 0;
  strcpy(v20, &quot;%s&quot;);
  strcpy(Format, &quot;%20s&quot;);
  v1 = 17;
  v2 = 8;
  v3 = 6;
  v4 = 10;
  v5 = 15;
  v6 = 20;
  v7 = 42;
  v8 = 59;
  v9 = 47;
  v10 = 3;
  v11 = 47;
  v12 = 4;
  v13 = 16;
  v14 = 72;
  v15 = 62;
  v16 = 0;
  v17 = 7;
  v18 = 16;
  scanf(Format, Str);
  if ( strlen(Str) != 18 )
  {
    printf(v20, &amp;v25);
    exit(1);
  }
  for ( i = 0; i &lt;= 17; ++i )
  {
    v43 = ~(Str[i] &amp; *((_BYTE *)&amp;v39 + i % 14)) &amp; (Str[i] | *((_BYTE *)&amp;v39 + i % 14));
    if ( v43 != *(&amp;v1 + i) )
    {
      printf(v20, &amp;v25);
      exit(1);
    }
  }
  printf(v20, &amp;v31);
  return printf(v20, &amp;v21);
}</code></pre>
<p>这里进行了简单的验证，中间得处理过程不是很好逆，因为涉及到与或非三种运算符，但是通过列真值表可以发现，这一串运算实际上和一个异或是一样的，所以这一部分就很好处理了</p>
<pre><code class="python">target = &#39;Rising_Hopper!&#39;
flag = &#39;&#39;
v1 = [17, 8, 6, 10, 15, 20, 42, 59, 47, 3, 47, 4, 16, 72, 62, 0, 7, 16]
for i in range(18):
    flag += chr(v1[i] ^ ord(target[i % 14]))
print(flag)</code></pre>
<p>输出<code>Caucasus@s_ability</code>，尝试提交发现不对，这题应该没这么简单，在找找有没有遗漏的地方，然后通过<code>Str</code>的交叉引用结果找到了遗漏的部分</p>
<pre><code class="c++">int sub_100401A6C()
{
  sub_100401506(sub_10040164D, 1045, (__int64)Str);
  sub_10040162B();
  return sub_10040164D();
}</code></pre>
<p>这个函数在输入并验证过<code>Str</code>之后又调用了我们的输入，肯定还会有后续的处理</p>
<pre><code class="c++">BOOL __fastcall sub_100401506(void *a1, int a2, __int64 a3)
{
  BOOL result; // eax
  DWORD flOldProtect; // [rsp+28h] [rbp-8h]
  int i; // [rsp+2Ch] [rbp-4h]
  LPVOID lpAddress; // [rsp+40h] [rbp+10h]
  int v7; // [rsp+48h] [rbp+18h]
  __int64 v8; // [rsp+50h] [rbp+20h]

  lpAddress = a1;
  v7 = a2;
  v8 = a3;
  if ( strlen(Str) != 18 )
    exit(1);
  if ( !VirtualProtect(lpAddress, v7, 0x40u, &amp;flOldProtect) )
    exit(1);
  for ( i = 0; i &lt; v7; ++i )
    *((_BYTE *)lpAddress + i) ^= *(_BYTE *)(i % 18 + v8);
  result = VirtualProtect(lpAddress, v7, flOldProtect, &amp;flOldProtect);
  if ( !result )
    exit(1);
  return result;
}</code></pre>
<p>这里是经过处理之后的内容，实际上是对一个地址上的数据进行了处理，显然是一个<code>SMC</code>的过程，这个地址里存储的应该是有用的处理代码，我们输入的内容实际上也只是对数据解密的密钥而已，所以接下来写个IDC脚本来解密一下</p>
<pre><code class="c++">#include &lt;idc.idc&gt;

static main() {
    auto start, end, addr;
    auto v1 = 67;
    auto v2 = 97;
    auto v3 = 117;
    auto v4 = 99;
    auto v5 = 97;
    auto v6 = 115;
    auto v7 = 117;
    auto v8 = 115;
    auto v9 = 64;
    auto v10 = 115;
    auto v11 = 95;
    auto v12 = 97;
    auto v13 = 98;
    auto v14 = 105;
    auto v15 = 108;
    auto v16 = 105;
    auto v17 = 116;
    auto v18 = 121;
    start = 0x10040164D;
    end = 0x100401A68;
//    auto flag = &quot;Caucasus@s_ability&quot;;
    auto flag;
    auto i = 0;
    for (addr = start; addr &lt; end; addr++) {
        if (i % 18 == 0)
            flag = v1;
        if (i % 18 == 1)
            flag = v2;
        if (i % 18 == 2)
            flag = v3;
        if (i % 18 == 3)
            flag = v4;
        if (i % 18 == 4)
            flag = v5;
        if (i % 18 == 5)
            flag = v6;
        if (i % 18 == 6)
            flag = v7;
        if (i % 18 == 7)
            flag = v8;
        if (i % 18 == 8)
            flag = v9;
        if (i % 18 == 9)
            flag = v10;
        if (i % 18 == 10)
            flag = v11;
        if (i % 18 == 11)
            flag = v12;
        if (i % 18 == 12)
            flag = v13;
        if (i % 18 == 13)
            flag = v14;
        if (i % 18 == 14)
            flag = v15;
        if (i % 18 == 15)
            flag = v16;
        if (i % 18 == 16)
            flag = v17;
        if (i % 18 == 17)
            flag = v18;
        PatchByte(addr, Byte(addr) ^ flag);
        i++;
    }
    AnalyzeArea(start, end);
    Message(&quot;Down!&quot;);
}</code></pre>
<p>不是很会用IDC，而且还没有数组类型，只能这样用很多分支去判断，然后得到了新的汇编代码，如果是汇编很好的话就可以直接做了，我还是习惯了无脑<code>F5</code>，所以干脆<code>patch</code>了一下后面的垃圾数据，写了一个<code>retn</code>，然后创建函数，查看伪代码</p>
<pre><code class="c++">int sub_10040164D()
{
  int result; // eax
  char Str[74]; // [rsp+20h] [rbp-60h]
  char v2[8]; // [rsp+6Ah] [rbp-16h]
  __int16 v3; // [rsp+78h] [rbp-8h]
  char v4; // [rsp+7Ah] [rbp-6h]
  char v5[4]; // [rsp+7Bh] [rbp-5h]
  char v6[8]; // [rsp+80h] [rbp+0h]
  char v7[8]; // [rsp+A0h] [rbp+20h]
  char Format[8]; // [rsp+D0h] [rbp+50h]
  int v9; // [rsp+110h] [rbp+90h]
  int v10; // [rsp+114h] [rbp+94h]
  int v11; // [rsp+118h] [rbp+98h]
  int v12; // [rsp+11Ch] [rbp+9Ch]
  int v13; // [rsp+120h] [rbp+A0h]
  int v14; // [rsp+124h] [rbp+A4h]
  int v15; // [rsp+128h] [rbp+A8h]
  int v16; // [rsp+12Ch] [rbp+ACh]
  int v17; // [rsp+130h] [rbp+B0h]
  int v18; // [rsp+134h] [rbp+B4h]
  int v19; // [rsp+138h] [rbp+B8h]
  int v20; // [rsp+13Ch] [rbp+BCh]
  int v21; // [rsp+140h] [rbp+C0h]
  int v22; // [rsp+144h] [rbp+C4h]
  int v23; // [rsp+148h] [rbp+C8h]
  int v24; // [rsp+14Ch] [rbp+CCh]
  int v25; // [rsp+150h] [rbp+D0h]
  int v26; // [rsp+154h] [rbp+D4h]
  int v27; // [rsp+158h] [rbp+D8h]
  int v28; // [rsp+15Ch] [rbp+DCh]
  int v29; // [rsp+160h] [rbp+E0h]
  int v30; // [rsp+164h] [rbp+E4h]
  int v31; // [rsp+168h] [rbp+E8h]
  int v32; // [rsp+16Ch] [rbp+ECh]
  int v33; // [rsp+170h] [rbp+F0h]
  int v34; // [rsp+174h] [rbp+F4h]
  int v35; // [rsp+178h] [rbp+F8h]
  int v36; // [rsp+17Ch] [rbp+FCh]
  int v37; // [rsp+180h] [rbp+100h]
  int v38; // [rsp+184h] [rbp+104h]
  int v39; // [rsp+188h] [rbp+108h]
  int v40; // [rsp+18Ch] [rbp+10Ch]
  int v41; // [rsp+190h] [rbp+110h]
  int v42; // [rsp+194h] [rbp+114h]
  int v43; // [rsp+198h] [rbp+118h]
  int v44; // [rsp+19Ch] [rbp+11Ch]
  int v45; // [rsp+1A0h] [rbp+120h]
  int v46; // [rsp+1A4h] [rbp+124h]
  int v47; // [rsp+1A8h] [rbp+128h]
  int v48; // [rsp+1ACh] [rbp+12Ch]
  int v49; // [rsp+1B0h] [rbp+130h]
  int v50; // [rsp+1B4h] [rbp+134h]
  int v51; // [rsp+1B8h] [rbp+138h]
  int v52; // [rsp+1BCh] [rbp+13Ch]
  int v53; // [rsp+1C0h] [rbp+140h]
  int v54; // [rsp+1C4h] [rbp+144h]
  int v55; // [rsp+1C8h] [rbp+148h]
  int v56; // [rsp+1CCh] [rbp+14Ch]
  int v57; // [rsp+1D0h] [rbp+150h]
  int v58; // [rsp+1D4h] [rbp+154h]
  int v59; // [rsp+1D8h] [rbp+158h]
  unsigned int v60; // [rsp+1E0h] [rbp+160h]
  int v61; // [rsp+1E4h] [rbp+164h]
  unsigned int v62; // [rsp+1E8h] [rbp+168h]
  unsigned int i; // [rsp+1ECh] [rbp+16Ch]

  v9 = 2007666;
  v10 = 2125764;
  v11 = 1909251;
  v12 = 2027349;
  v13 = 2421009;
  v14 = 1653372;
  v15 = 2047032;
  v16 = 2184813;
  v17 = 2302911;
  v18 = 2263545;
  v19 = 1909251;
  v20 = 2165130;
  v21 = 1968300;
  v22 = 2243862;
  v23 = 2066715;
  v24 = 2322594;
  v25 = 1987983;
  v26 = 2243862;
  v27 = 1869885;
  v28 = 2066715;
  v29 = 2263545;
  v30 = 1869885;
  v31 = 964467;
  v32 = 944784;
  v33 = 944784;
  v34 = 944784;
  v35 = 728271;
  v36 = 1869885;
  v37 = 2263545;
  v38 = 2283228;
  v39 = 2243862;
  v40 = 2184813;
  v41 = 2165130;
  v42 = 2027349;
  v43 = 1987983;
  v44 = 2243862;
  v45 = 1869885;
  v46 = 2283228;
  v47 = 2047032;
  v48 = 1909251;
  v49 = 2165130;
  v50 = 1869885;
  v51 = 2401326;
  v52 = 1987983;
  v53 = 2243862;
  v54 = 2184813;
  v55 = 885735;
  v56 = 2184813;
  v57 = 2165130;
  v58 = 1987983;
  v59 = 2460375;
  strcpy(Format, &quot;Input the flag to hijack the ability of Hiden Intelligence:&quot;);
  strcpy(v7, &quot;Progrise Key confirmed. Ready to break.\n&quot;);
  strcpy(v6, &quot;Jacking Break! Zaia Enterprise.&quot;);
  strcpy(v5, &quot;%59s&quot;);
  v3 = 29477;
  v4 = 0;
  strcpy(v2, &quot;Not verified!&quot;);
  v62 = 2147483659;
  printf(Format);
  scanf(v5, Str);
  printf(v7);
  if ( strlen(Str) != 51 )
  {
    printf(v2);
    exit(0);
  }
  v61 = 19683;
  for ( i = 0; i &lt;= 0x32; ++i )
  {
    v60 = v61 * (unsigned int)(unsigned __int8)Str[i] % v62;
    if ( v60 != *(&amp;v9 + i) )
    {
      printf(v2);
      exit(0);
    }
  }
  printf(v6);
  getchar();
  result = getchar();
  __asm { icebp }
  return result;
}</code></pre>
<p>关键的处理只有一句，但是有个很烦的取余，仔细观察可以发现，<code>v62</code>这个数非常大，最后在计算的时候取不取这个余数都没关系，所以这一部分又变成了一个非常简单的除法，然后问题就很容易解决了</p>
<pre><code class="python">v9 = [2007666, 2125764, 1909251, 2027349, 2421009, 1653372, 2047032, 2184813, 2302911, 2263545, 1909251, 2165130,
      1968300, 2243862, 2066715, 2322594, 1987983, 2243862, 1869885, 2066715, 2263545, 1869885, 964467, 944784, 944784,
      944784, 728271, 1869885, 2263545, 2283228, 2243862, 2184813, 2165130, 2027349, 1987983, 2243862, 1869885, 2283228,
      2047032, 1909251, 2165130, 1869885, 2401326, 1987983, 2243862, 2184813, 885735, 2184813, 2165130, 1987983,
      2460375]
v61 = 19683
v62 = 0x8000000B
flag = &#39;&#39;
for i in range(0x33):
    flag += chr(v9[i] // v61)
print(flag)</code></pre>
<p>输出flag</p>
<pre><code>flag{Thousandriver_is_1000%_stronger_than_zero-one}</code></pre><h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><p>然后这次比赛就没打算再做了，<code>mobile</code>的题，研究了一下，应该不是特别难，但是没太有时间，又是作业又是网课又是美赛，让人很烦，如果后面有wp放出来的话再去研究研究，复现一下，做个补充。</p>

          
            <div class='article_footer'>
              
                
  
    
    



  

  
    
    



  

  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=http://blog.rycbar.club/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB-%E4%B8%A4%E9%81%93re-wp/>http://blog.rycbar.club/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB-%E4%B8%A4%E9%81%93re-wp/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  


              
            </div>
          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-03-16T16:07:31+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2020年3月16日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/ctf/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>ctf</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/writeup/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>writeup</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/re/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>re</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>高校战“疫”</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.rycbar.club/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB-%E4%B8%A4%E9%81%93re-wp/&title=高校战疫-两道re-wp - My Tiny Ideas&summary=这两天攻防世界有个比赛，上面的题目还不错，参与了一下，至于为什么是两道re，因为正好赶上数模美赛，没怎么有时间做（实际上就是因为菜"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.rycbar.club/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB-%E4%B8%A4%E9%81%93re-wp/&title=高校战疫-两道re-wp - My Tiny Ideas&summary=这两天攻防世界有个比赛，上面的题目还不错，参与了一下，至于为什么是两道re，因为正好赶上数模美赛，没怎么有时间做（实际上就是因为菜"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=http://blog.rycbar.club/2020/03/09/%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB-%E4%B8%A4%E9%81%93re-wp/&title=高校战疫-两道re-wp - My Tiny Ideas&summary=这两天攻防世界有个比赛，上面的题目还不错，参与了一下，至于为什么是两道re，因为正好赶上数模美赛，没怎么有时间做（实际上就是因为菜"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2020/03/10/IDA%E5%B8%B8%E7%94%A8%E5%AE%8F%E5%AE%9A%E4%B9%89/'>
                <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>IDA常用宏定义</p>
                <p class='content'>保存一下便于查询。


/*

   This file contains definitions used by the Hex-Rays decompiler output.
   It h...</p>
              </a>
            
            
              <a class='next' href='/2020/03/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-pwn%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/'>
                <p class='title'>攻防世界-pwn部分题解（一）<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>一直做re觉得有些枯燥，闲着没事做一做好久没碰的pwn


level2checksec一下，开了NX
int __cdecl main(int argc, const char **argv,...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box reveal comments shadow">
    <section class="article typo">
      <p ct><i class='fas fa-comments'></i> 评论</p>
      
      
      
      
        <section id="comments">
          <div id="gitalk-container"></div>
        </section>
      
      
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '高校战疫-两道re-wp',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    


  <section class="widget toc-wrapper shadow desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#cyclegraph"><span class="toc-text">cyclegraph</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#天津垓"><span class="toc-text">天津垓</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#后记"><span class="toc-text">后记</span></a></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='true'
      volume='0.7'
      loop='all'
      order='random'
      fixed='false'
      list-max-height='340px'
      server='netease'
      type='playlist'
      id='555017395'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/rycbar17th@gmail.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/schrodinger17"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=391265665"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        <div class='copyright'>
        <p><a href="https://blog.rycbar.club">Copyright © 2017-2020 rycbar</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '8px',
        duration: '800',
        interval: '100',
        scale: '1'
      });
    });
  </script>


  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/BBC19066-E176-47C2-9D22-48C81EE5DF6B.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/B18FCBB3-67FD-48CC-B4F3-457BA145F17A.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/35F12181-F0E9-45BD-B134-37E4B4A660CF.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/00E0F0ED-9F1C-407A-9AA6-545649D919F4.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/67239FBB-E15D-4F4F-8EE8-0F1C9F3C4E7C.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/B951AE18-D431-417F-B3FE-A382403FF21B.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/AEB33F9D-7294-4CF1-B8C5-3020748A9D45.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/2884F904-F1F3-479E-AE27-5EBC291B63B0.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/10A0FCE5-36A1-4AD0-8CF0-019259A89E03.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/250662D4-5A21-4AAA-BB63-CD25CF97CFF1.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/landscape/298468D7-E388-44A8-8CC5-8213BDC33CED.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  






  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: "6dbe0fb891585031b176",
      clientSecret: "4407fec5af8e37150b5a4cb82821318d91c07769",
      repo: "comments",
      owner: "schrodinger17",
      admin: "schrodinger17",
      
        id: location.pathname,      // Ensure uniqueness and length less than 50
      
      distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
  </script>








  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.6.5/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>




  
    
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
  



<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
</body>
</html>
